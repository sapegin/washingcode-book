# TODO: Rich typo

BOOK_FILE="washing-code"
BOOK_TITLE="Washing your code: clean code for frontend developers"
CHAPTERS_FILES="generator/settings.md generator/content/*.md"
# TODO: Add the rest of the chapters
COVER="manuscript/resources/images/cover.jpg"
VERSION="$(date "+%B %e, %Y")"
DIST_DIR=dist

mkdir -p "$DIST_DIR"

# Generate PDF
echo "[BUILD] Generate PDF ebook..."

pandoc $CHAPTERS_FILES \
	--resource-path="manuscript/resources" \
	--output="$DIST_DIR/$BOOK_FILE-content.pdf" \
  --top-level-division=chapter \
	--table-of-contents --toc-depth=2 \
  --template="generator/eisvogel.latex" \
	--highlight-style "generator/theme.theme" \
  --lua-filter "generator/filters/tips.lua" \
  -f commonmark_x \
	-M date="$VERSION"

# Attach the cover
pdfunite "generator/cover.pdf" "$DIST_DIR/$BOOK_FILE-content.pdf" "$DIST_DIR/$BOOK_FILE.pdf"

# Remove the temporary file generated by Pandoc
rm "$DIST_DIR/$BOOK_FILE-content.pdf"

# pandoc $CHAPTERS_FILES \
# 	--resource-path=src \
# 	--output=$DIST_DIR/$BOOK_FILE.epub \
# 	--table-of-contents --toc-depth=2 \
# 	--top-level-division=chapter \
# 	--number-sections \
# 	--listings \
# 	--standalone \
# 	--epub-cover-image="$COVER" \
# 	--metadata title="$BOOK_FILE" \
# 	--highlight-style theme.json \
# 	--css epub.css \
# 	-M date="$VERSION"
